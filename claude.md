# ì‹í’ˆ ì œì¡° ê³µì • BPMN ì›¹ ì„œë¹„ìŠ¤ - ê¸°ìˆ  ì²­ì‚¬ì§„

---

## 1. ì œí’ˆ ì„¤ê³„ ìš”êµ¬ì‚¬í•­ (PDR)

### 1.1 í”„ë¡œì íŠ¸ ë¹„ì „
ì‹í’ˆ ì œì¡°ì—…ì²´ë¥¼ ìœ„í•œ ì§ê´€ì ì´ê³  ê°•ë ¥í•œ BPMN(Business Process Model and Notation) í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•©ë‹ˆë‹¤. ì‹í’ˆ ì œì¡° ê³µì •ì˜ ë³µì¡í•œ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹œê°í™”í•˜ê³ , ê´€ë¦¬í•˜ë©°, ìµœì í™”í•  ìˆ˜ ìˆëŠ” í”Œë«í¼ì„ ì œê³µí•©ë‹ˆë‹¤.

### 1.2 ëŒ€ìƒ ì‚¬ìš©ì
- **ì£¼ìš” ì‚¬ìš©ì**: ì‹í’ˆ ì œì¡°ì—…ì²´ì˜ ê³µì • ê´€ë¦¬ì, í’ˆì§ˆ ê´€ë¦¬ ë‹´ë‹¹ì
- **ë³´ì¡° ì‚¬ìš©ì**: ìƒì‚° ë¼ì¸ ê°ë…ì, ê²½ì˜ì§„
- **ê¸°ìˆ  ìˆ˜ì¤€**: ê¸°ë³¸ì ì¸ ì›¹ ë¸Œë¼ìš°ì € ì‚¬ìš© ëŠ¥ë ¥

### 1.3 í•µì‹¬ ê¸°ëŠ¥

#### í•„ìˆ˜ ê¸°ëŠ¥
1. **BPMN ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±**
   - ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ ìš”ì†Œ ì¶”ê°€
   - ì‹í’ˆ ì œì¡° ê³µì •ì— íŠ¹í™”ëœ í…œí”Œë¦¿ ì œê³µ
   - ì‹¤ì‹œê°„ ì‹œê°ì  í”¼ë“œë°±

2. **ë‹¤ì´ì–´ê·¸ë¨ ìˆ˜ì •**
   - ë…¸ë“œ ìœ„ì¹˜ ì´ë™ ë° í¬ê¸° ì¡°ì •
   - ì—°ê²°ì„ (flow) ìˆ˜ì • ë° ì¬ë°°ì¹˜
   - ì†ì„± í¸ì§‘ (ì´ë¦„, ì„¤ëª…, ì±…ì„ì ë“±)

3. **í”„ë¡œì„¸ìŠ¤ ì¶”ê°€**
   - ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ ë‹¨ê³„ ì‚½ì…
   - ì¡°ê±´ë¶€ ë¶„ê¸° ì¶”ê°€
   - ë³‘ë ¬ ì²˜ë¦¬ ê²½ë¡œ ìƒì„±

4. **í”„ë¡œì„¸ìŠ¤ ì‚­ì œ**
   - ê°œë³„ ë…¸ë“œ ì‚­ì œ
   - ì—°ê´€ëœ ì—°ê²°ì„  ìë™ ì •ë¦¬
   - ì‚­ì œ ì „ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸

5. **ì €ì¥ ë° ë²„ì „ ê´€ë¦¬**
   - ìë™ ì €ì¥ ê¸°ëŠ¥
   - ë²„ì „ íˆìŠ¤í† ë¦¬ ì¶”ì 
   - ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±

6. **ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸°**
   - BPMN 2.0 XML í˜•ì‹ ì§€ì›
   - PNG/SVG ì´ë¯¸ì§€ ë‚´ë³´ë‚´ê¸°
   - ê¸°ì¡´ BPMN íŒŒì¼ ê°€ì ¸ì˜¤ê¸°

#### ë¶€ê°€ ê¸°ëŠ¥
- í˜‘ì—… ê¸°ëŠ¥ (ë©€í‹° ìœ ì € í¸ì§‘)
- ëŒ“ê¸€ ë° ì£¼ì„
- í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ ì‹œë®¬ë ˆì´ì…˜
- ëª¨ë°”ì¼ ë°˜ì‘í˜• ë·°ì–´

### 1.4 ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

#### ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­
- **FR-001**: ì‚¬ìš©ìëŠ” 3ë²ˆì˜ í´ë¦­ ì´ë‚´ì— ìƒˆ ë‹¤ì´ì–´ê·¸ë¨ì„ ìƒì„±í•  ìˆ˜ ìˆì–´ì•¼ í•¨
- **FR-002**: ëª¨ë“  ë³€ê²½ì‚¬í•­ì€ 3ì´ˆ ì´ë‚´ì— ìë™ ì €ì¥ë˜ì–´ì•¼ í•¨
- **FR-003**: ë‹¤ì´ì–´ê·¸ë¨ì€ BPMN 2.0 í‘œì¤€ì„ ì¤€ìˆ˜í•´ì•¼ í•¨
- **FR-004**: ì‚¬ìš©ìëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ê²½ì‚¬í•­ì„ ë¯¸ë¦¬ë³¼ ìˆ˜ ìˆì–´ì•¼ í•¨
- **FR-005**: ìµœì†Œ 10ê°œì˜ ì‹í’ˆ ì œì¡° ê³µì • í…œí”Œë¦¿ ì œê³µ

#### ë¹„ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­
- **NFR-001 ì„±ëŠ¥**: í˜ì´ì§€ ë¡œë“œ ì‹œê°„ < 2ì´ˆ
- **NFR-002 í™•ì¥ì„±**: 1,000ê°œ ì´ìƒì˜ ë…¸ë“œë¥¼ ê°€ì§„ ë‹¤ì´ì–´ê·¸ë¨ ì²˜ë¦¬ ê°€ëŠ¥
- **NFR-003 ê°€ìš©ì„±**: 99.5% ì—…íƒ€ì„ ë³´ì¥
- **NFR-004 ì ‘ê·¼ì„±**: WCAG 2.1 AA ë ˆë²¨ ì¤€ìˆ˜
- **NFR-005 ë¸Œë¼ìš°ì € í˜¸í™˜ì„±**: Chrome, Firefox, Safari, Edge ìµœì‹  2ê°œ ë²„ì „

### 1.5 ë¬¸ì œ í•´ê²°
- **ë¬¸ì œ**: ê¸°ì¡´ BPMN ë„êµ¬ëŠ” ë³µì¡í•˜ê³  ì‹í’ˆ ì œì¡°ì—…ì— íŠ¹í™”ë˜ì§€ ì•ŠìŒ
- **í•´ê²°**: ì‹í’ˆ ì œì¡° ê³µì •ì— ìµœì í™”ëœ í…œí”Œë¦¿ê³¼ ì§ê´€ì ì¸ UI ì œê³µ
- **ê°€ì¹˜**: ê³µì • ì„¤ê³„ ì‹œê°„ 50% ë‹¨ì¶•, í‘œì¤€í™”ë¥¼ í†µí•œ í’ˆì§ˆ í–¥ìƒ

---

## 2. ê¸°ìˆ  ìŠ¤íƒ

### 2.1 í”„ë¡ íŠ¸ì—”ë“œ

#### ì½”ì–´ í”„ë ˆì„ì›Œí¬
```
Next.js 14+ (App Router)
- ì´ìœ : ì„œë²„ ì»´í¬ë„ŒíŠ¸ì™€ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì˜ ìµœì í™”ëœ ë¶„ë¦¬
- ì¥ì : SSR, SSG, ISRì„ í†µí•œ ì„±ëŠ¥ ìµœì í™”
- ì¥ì : API Routesë¡œ ë°±ì—”ë“œ ë¡œì§ í†µí•©
```

#### UI ë¼ì´ë¸ŒëŸ¬ë¦¬
```
shadcn/ui
- ì´ìœ : Tailwind CSS ê¸°ë°˜ì˜ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸
- ì¥ì : ë³µì‚¬-ë¶™ì—¬ë„£ê¸° ë°©ì‹ìœ¼ë¡œ í”„ë¡œì íŠ¸ ë‚´ ì™„ì „í•œ ì œì–´
- ì¥ì : Radix UI ê¸°ë°˜ìœ¼ë¡œ ì ‘ê·¼ì„± ë³´ì¥
```

#### BPMN ë Œë”ë§
```
bpmn-js (bpmn.io)
- ì´ìœ : BPMN 2.0 í‘œì¤€ì˜ ì‚¬ì‹¤ìƒ í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
- ì¥ì : ê°•ë ¥í•œ ëª¨ë¸ë§ ë° ë Œë”ë§ ê¸°ëŠ¥
- ì¥ì : í™•ì¥ ê°€ëŠ¥í•œ í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ
```

#### ìŠ¤íƒ€ì¼ë§
```
Tailwind CSS 3+
- ì´ìœ : ìœ í‹¸ë¦¬í‹° ìš°ì„  ë°©ì‹ìœ¼ë¡œ ë¹ ë¥¸ ê°œë°œ
- ì¥ì : shadcn/uiì™€ ì™„ë²½í•œ í†µí•©
- ì¥ì : ì‘ì€ ë²ˆë“¤ ì‚¬ì´ì¦ˆ (PurgeCSS)
```

#### ìƒíƒœ ê´€ë¦¬
```
Zustand
- ì´ìœ : ê°„ë‹¨í•˜ê³  ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ê°€ ì ì€ ìƒíƒœ ê´€ë¦¬
- ì¥ì : React Server Componentsì™€ í˜¸í™˜
- ì¥ì : TypeScript ì™„ë²½ ì§€ì›
```

#### í¼ ê´€ë¦¬
```
React Hook Form + Zod
- ì´ìœ : ì„±ëŠ¥ ìµœì í™”ëœ í¼ ì²˜ë¦¬
- ì¥ì : Zodë¥¼ í†µí•œ íƒ€ì… ì•ˆì „ ìœ íš¨ì„± ê²€ì‚¬
```

### 2.2 ë°±ì—”ë“œ

#### ë°ì´í„°ë² ì´ìŠ¤
```
Vercel Postgres (Neon)
- ì´ìœ : Vercel í”Œë«í¼ê³¼ ë„¤ì´í‹°ë¸Œ í†µí•©
- ì¥ì : ì„œë²„ë¦¬ìŠ¤ í™•ì¥, ìë™ ë°±ì—…
- ì¥ì : Connection pooling ë‚´ì¥
```

#### ORM
```
Drizzle ORM
- ì´ìœ : TypeScript ìš°ì„ , Next.jsì™€ ìµœì  í˜¸í™˜
- ì¥ì : íƒ€ì… ì•ˆì „ ì¿¼ë¦¬
- ì¥ì : ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬ ê°„í¸
```

#### ì¸ì¦
```
Clerk
- ì´ìœ : ë°°í‹€ í…ŒìŠ¤íŠ¸ëœ ì¸ì¦ ì†”ë£¨ì…˜
- ì¥ì : ì†Œì…œ ë¡œê·¸ì¸, MFA ì§€ì›
- ì¥ì : Next.js ë¯¸ë“¤ì›¨ì–´ì™€ ì™„ë²½ í†µí•©
- ë³´ì•ˆ: ì„¸ì…˜ ê´€ë¦¬, í† í° ìë™ ê°±ì‹ 
```

#### API
```
Next.js API Routes (App Router)
- ì´ìœ : ë³„ë„ ë°±ì—”ë“œ ì„œë²„ ë¶ˆí•„ìš”
- ì¥ì : Edge Runtime ì§€ì›
- ì¥ì : íƒ€ì… ê³µìœ  ìš©ì´
```

### 2.3 ë°°í¬ ë° ì¸í”„ë¼

#### í˜¸ìŠ¤íŒ…
```
Vercel
- ì´ìœ : Next.js ìµœì í™” í”Œë«í¼
- ì¥ì : ìë™ HTTPS, CDN, DDoS ë³´í˜¸
- ì¥ì : Git ê¸°ë°˜ ìë™ ë°°í¬
- ë³´ì•ˆ: í™˜ê²½ë³€ìˆ˜ ì•”í˜¸í™” ì €ì¥
```

#### íŒŒì¼ ìŠ¤í† ë¦¬ì§€
```
Vercel Blob
- ì´ìœ : ë‹¤ì´ì–´ê·¸ë¨ ì´ë¯¸ì§€ ì €ì¥
- ì¥ì : CDN í†µí•©, ìë™ ìµœì í™”
```

### 2.4 ê°œë°œ ë„êµ¬

```
- TypeScript: íƒ€ì… ì•ˆì „ì„±
- ESLint + Prettier: ì½”ë“œ í’ˆì§ˆ
- Husky + lint-staged: Pre-commit í›…
- Jest + React Testing Library: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- Playwright: E2E í…ŒìŠ¤íŠ¸
```

### 2.5 ëª¨ë‹ˆí„°ë§ ë° ë¶„ì„

```
- Vercel Analytics: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- Sentry: ì—ëŸ¬ íŠ¸ë˜í‚¹
```

---

## 3. ì•± í”Œë¡œìš°ì°¨íŠ¸

### 3.1 ì‚¬ìš©ì í”Œë¡œìš°

```
[ì‚¬ìš©ì] 
   |
   v
[ëœë”© í˜ì´ì§€] --> [ë¡œê·¸ì¸/íšŒì›ê°€ì… (Clerk)]
   |                        |
   v                        v
[ëŒ€ì‹œë³´ë“œ]            [ì´ë©”ì¼ ì¸ì¦]
   |                        |
   |<-----------------------+
   |
   +---> [ìƒˆ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±]
   |        |
   |        v
   |     [BPMN ì—ë””í„°]
   |        |
   |        +---> [ìš”ì†Œ ì¶”ê°€/ì‚­ì œ]
   |        +---> [ì†ì„± í¸ì§‘]
   |        +---> [ì—°ê²°ì„  ê·¸ë¦¬ê¸°]
   |        +---> [ìë™ ì €ì¥] --> [DB ì €ì¥]
   |        +---> [ë‚´ë³´ë‚´ê¸°] --> [íŒŒì¼ ë‹¤ìš´ë¡œë“œ]
   |
   +---> [ê¸°ì¡´ ë‹¤ì´ì–´ê·¸ë¨ ì—´ê¸°]
   |        |
   |        v
   |     [ë‹¤ì´ì–´ê·¸ë¨ ëª©ë¡]
   |        |
   |        v
   |     [BPMN ì—ë””í„°]
   |
   +---> [í…œí”Œë¦¿ ê°¤ëŸ¬ë¦¬]
            |
            v
         [í…œí”Œë¦¿ ì„ íƒ] --> [BPMN ì—ë””í„°]
```

### 3.2 ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
[í´ë¼ì´ì–¸íŠ¸]
    |
    | HTTPS
    |
    v
[Vercel Edge Network]
    |
    +---> [ì •ì  ìì‚°] --> [CDN]
    |
    +---> [Next.js App]
            |
            +---> [Server Components]
            |        |
            |        v
            |     [ë°ì´í„° í˜ì¹­]
            |        |
            |        v
            |     [Vercel Postgres]
            |
            +---> [Client Components]
            |        |
            |        v
            |     [bpmn-js ë Œë”ë§]
            |
            +---> [API Routes]
                   |
                   +---> [ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ (Clerk)]
                   |
                   +---> [ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§]
                   |        |
                   |        v
                   |     [Drizzle ORM]
                   |        |
                   |        v
                   |     [Vercel Postgres]
                   |
                   +---> [íŒŒì¼ ì²˜ë¦¬]
                            |
                            v
                         [Vercel Blob]
```

### 3.3 ë°ì´í„° í”Œë¡œìš°

```
[ì‚¬ìš©ì ì•¡ì…˜]
    |
    v
[React ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬]
    |
    v
[Zustand ìƒíƒœ ì—…ë°ì´íŠ¸]
    |
    +---> [UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸]
    |
    +---> [Debounced API í˜¸ì¶œ]
            |
            v
         [API Route]
            |
            +---> [ì¸ì¦ ê²€ì¦]
            |        |
            |        | (ì‹¤íŒ¨)
            |        v
            |     [401 Unauthorized]
            |
            | (ì„±ê³µ)
            v
         [ìš”ì²­ ìœ íš¨ì„± ê²€ì‚¬ (Zod)]
            |
            | (ì‹¤íŒ¨)
            v
         [400 Bad Request]
            |
            | (ì„±ê³µ)
            v
         [DB íŠ¸ëœì­ì…˜]
            |
            v
         [ì‘ë‹µ ë°˜í™˜]
            |
            v
         [í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ë™ê¸°í™”]
```

---

## 4. í”„ë¡œì íŠ¸ ê·œì¹™

### 4.1 ê°œë°œ best practices

#### ì½”ë“œ ìŠ¤íƒ€ì¼
- **Prettier** ì„¤ì • ì‚¬ìš© (ìë™ í¬ë§·íŒ…)
- **ESLint** ê·œì¹™ ì—„ê²©íˆ ì¤€ìˆ˜
- ë³€ìˆ˜ëª…: `camelCase` (í•¨ìˆ˜, ë³€ìˆ˜), `PascalCase` (ì»´í¬ë„ŒíŠ¸, íƒ€ì…)
- ìƒìˆ˜: `UPPER_SNAKE_CASE`
- íŒŒì¼ëª…: `kebab-case.tsx` (ì»´í¬ë„ŒíŠ¸), `camelCase.ts` (ìœ í‹¸)

#### TypeScript ê·œì¹™
```typescript
// âœ… ëª…ì‹œì  íƒ€ì… ì •ì˜
interface User {
  id: string;
  name: string;
  email: string;
}

// âœ… íƒ€ì… ê°€ë“œ ì‚¬ìš©
function isUser(obj: unknown): obj is User {
  return typeof obj === 'object' && obj !== null && 'id' in obj;
}

// âŒ any ì‚¬ìš© ê¸ˆì§€
// const data: any = fetchData(); // ì ˆëŒ€ ì•ˆë¨

// âœ… unknown ì‚¬ìš© í›„ íƒ€ì… ê°€ë“œ
const data: unknown = fetchData();
if (isUser(data)) {
  console.log(data.name);
}
```

#### ì»´í¬ë„ŒíŠ¸ ì‘ì„± ê·œì¹™
```typescript
// âœ… íŒŒì¼ êµ¬ì¡°
// 1. imports
// 2. types/interfaces
// 3. constants
// 4. component
// 5. exports

// âœ… Props íƒ€ì… ì •ì˜
interface ButtonProps {
  onClick: () => void;
  children: React.ReactNode;
  variant?: 'primary' | 'secondary';
}

// âœ… ì»´í¬ë„ŒíŠ¸ëŠ” ëª…í™•í•œ ë‹¨ì¼ ì±…ì„
export function Button({ onClick, children, variant = 'primary' }: ButtonProps) {
  return <button onClick={onClick}>{children}</button>;
}
```

### 4.2 ë²„ì „ ê´€ë¦¬ ì „ëµ

#### Git ë¸Œëœì¹˜ ì „ëµ (Git Flow ê°„ì†Œí™” ë²„ì „)
```
main (production)
  |
  +-- develop (development)
        |
        +-- feature/bpmn-editor
        +-- feature/dashboard
        +-- fix/save-bug
        +-- refactor/api-routes
```

#### ë¸Œëœì¹˜ ëª…ëª… ê·œì¹™
- `feature/ê¸°ëŠ¥ëª…`: ìƒˆ ê¸°ëŠ¥ ê°œë°œ
- `fix/ë²„ê·¸ëª…`: ë²„ê·¸ ìˆ˜ì •
- `refactor/ëŒ€ìƒ`: ë¦¬íŒ©í† ë§
- `docs/ë¬¸ì„œëª…`: ë¬¸ì„œ ì‘ì—…
- `test/í…ŒìŠ¤íŠ¸ëª…`: í…ŒìŠ¤íŠ¸ ì¶”ê°€/ìˆ˜ì •

#### ì»¤ë°‹ ë©”ì‹œì§€ ê·œì¹™ (Conventional Commits)
```
feat: BPMN ì—ë””í„° ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥ ì¶”ê°€
fix: ìë™ ì €ì¥ íƒ€ì´ë° ë²„ê·¸ ìˆ˜ì •
refactor: API ë¼ìš°íŠ¸ êµ¬ì¡° ê°œì„ 
docs: READMEì— ì„¤ì¹˜ ê°€ì´ë“œ ì¶”ê°€
test: ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± E2E í…ŒìŠ¤íŠ¸ ì¶”ê°€
chore: ì˜ì¡´ì„± ì—…ë°ì´íŠ¸
```

#### PR(Pull Request) ê·œì¹™
1. **PR ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸**
   - [ ] ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼
   - [ ] ESLint ê²½ê³  ì—†ìŒ
   - [ ] íƒ€ì… ì—ëŸ¬ ì—†ìŒ
   - [ ] ë³€ê²½ì‚¬í•­ ë¬¸ì„œí™”

2. **PR í…œí”Œë¦¿**
   ```markdown
   ## ë³€ê²½ì‚¬í•­
   - êµ¬ì²´ì ì¸ ë³€ê²½ ë‚´ìš© ë‚˜ì—´
   
   ## í…ŒìŠ¤íŠ¸
   - ì–´ë–»ê²Œ í…ŒìŠ¤íŠ¸í–ˆëŠ”ì§€ ì„¤ëª…
   
   ## ìŠ¤í¬ë¦°ìƒ· (UI ë³€ê²½ ì‹œ)
   - Before/After ì´ë¯¸ì§€
   ```

3. **ë¦¬ë·° ê·œì¹™**
   - ìµœì†Œ 1ëª…ì˜ ìŠ¹ì¸ í•„ìš”
   - ë¦¬ë·° ìš”ì²­ í›„ 24ì‹œê°„ ì´ë‚´ ì‘ë‹µ

### 4.3 í…ŒìŠ¤íŠ¸ ì „ëµ

#### í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ
```
      E2E (10%)
    /          \
   Integration (30%)
  /                \
Unit Tests (60%)
```

#### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Jest + RTL)
```typescript
// ëª¨ë“  ìœ í‹¸ í•¨ìˆ˜ì™€ í›…ì€ í…ŒìŠ¤íŠ¸ í•„ìˆ˜
describe('parseBpmnXml', () => {
  it('should parse valid BPMN XML', () => {
    const xml = '<bpmn:definitions>...</bpmn:definitions>';
    const result = parseBpmnXml(xml);
    expect(result).toBeDefined();
  });

  it('should throw error for invalid XML', () => {
    expect(() => parseBpmnXml('invalid')).toThrow();
  });
});
```

#### E2E í…ŒìŠ¤íŠ¸ (Playwright)
```typescript
// í•µì‹¬ ì‚¬ìš©ì í”Œë¡œìš° í…ŒìŠ¤íŠ¸
test('user can create and save diagram', async ({ page }) => {
  await page.goto('/dashboard');
  await page.click('button:has-text("ìƒˆ ë‹¤ì´ì–´ê·¸ë¨")');
  // ... ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ë¡œì§
  await expect(page.locator('.success-message')).toBeVisible();
});
```

### 4.4 ì½”ë“œ ë¦¬ë·° ê°€ì´ë“œë¼ì¸

#### ë¦¬ë·°ì–´ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì½”ë“œê°€ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ”ê°€?
- [ ] ë³´ì•ˆ ì·¨ì•½ì ì€ ì—†ëŠ”ê°€?
- [ ] ì„±ëŠ¥ ì´ìŠˆëŠ” ì—†ëŠ”ê°€?
- [ ] í…ŒìŠ¤íŠ¸ê°€ ì¶©ë¶„í•œê°€?
- [ ] ê°€ë…ì„±ì´ ì¢‹ì€ê°€?
- [ ] ì¤‘ë³µ ì½”ë“œëŠ” ì—†ëŠ”ê°€?

#### ë¦¬ë·° ì½”ë©˜íŠ¸ ê·œì¹™
- **í•„ìˆ˜ ë³€ê²½**: `[MUST]` íƒœê·¸ ì‚¬ìš©
- **ì œì•ˆ**: `[SUGGESTION]` íƒœê·¸ ì‚¬ìš©
- **ì§ˆë¬¸**: `[QUESTION]` íƒœê·¸ ì‚¬ìš©

### 4.5 ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œë¼ì¸

#### ë²ˆë“¤ ì‚¬ì´ì¦ˆ ê´€ë¦¬
```typescript
// âœ… ë™ì  import ì‚¬ìš©
const BpmnEditor = dynamic(() => import('@/components/bpmn-editor'), {
  loading: () => <Skeleton />,
  ssr: false, // bpmn-jsëŠ” ë¸Œë¼ìš°ì € ì „ìš©
});

// âŒ ì „ì²´ import ê¸ˆì§€
// import * as bpmn from 'bpmn-js'; // í° ë²ˆë“¤ ì‚¬ì´ì¦ˆ
```

#### ì´ë¯¸ì§€ ìµœì í™”
```typescript
// âœ… Next.js Image ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
import Image from 'next/image';

<Image
  src="/template-thumb.png"
  alt="í…œí”Œë¦¿"
  width={300}
  height={200}
  loading="lazy"
/>
```

### 4.6 ì ‘ê·¼ì„± (a11y) ê¸°ì¤€

- **í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜**: ëª¨ë“  ê¸°ëŠ¥ í‚¤ë³´ë“œë¡œ ì ‘ê·¼ ê°€ëŠ¥
- **ìŠ¤í¬ë¦° ë¦¬ë”**: ARIA ì†ì„± ì ì ˆíˆ ì‚¬ìš©
- **ìƒ‰ìƒ ëŒ€ë¹„**: ìµœì†Œ 4.5:1 ë¹„ìœ¨
- **í¬ì»¤ìŠ¤ í‘œì‹œ**: ëª…í™•í•œ í¬ì»¤ìŠ¤ ë§

```typescript
// âœ… ì ‘ê·¼ì„± ì¢‹ì€ ë²„íŠ¼
<button
  aria-label="ë‹¤ì´ì–´ê·¸ë¨ ì €ì¥"
  onClick={handleSave}
  className="focus:ring-2 focus:ring-offset-2"
>
  <SaveIcon aria-hidden="true" />
  ì €ì¥
</button>
```

---

## 5. êµ¬í˜„ ê³„íš

### 5.1 í”„ë¡œì íŠ¸ ë‹¨ê³„ (ì´ 8ì£¼)

#### Phase 1: í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì • (1ì£¼)
**ëª©í‘œ**: ê°œë°œ í™˜ê²½ êµ¬ì¶• ë° ê¸°ë³¸ êµ¬ì¡° ì„¤ì •

**íƒœìŠ¤í¬**:
1. **í”„ë¡œì íŠ¸ ìƒì„± ë° ì„¤ì •** (1ì¼)
   ```bash
   npx create-next-app@latest bpmn-flow --typescript --tailwind --app
   cd bpmn-flow
   ```
   - Next.js 14 + TypeScript + Tailwind CSS ì„¤ì •
   - shadcn/ui ì´ˆê¸°í™”
   - í´ë” êµ¬ì¡° ìƒì„±

2. **ì˜ì¡´ì„± ì„¤ì¹˜** (1ì¼)
   ```bash
   npm install bpmn-js zustand drizzle-orm @clerk/nextjs
   npm install -D @types/bpmn-js drizzle-kit
   ```

3. **Vercel í”„ë¡œì íŠ¸ ì—°ê²°** (1ì¼)
   - Vercel í”„ë¡œì íŠ¸ ìƒì„±
   - Vercel Postgres ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
   - í™˜ê²½ë³€ìˆ˜ ì„¤ì •

4. **Clerk ì¸ì¦ ì„¤ì •** (1ì¼)
   - Clerk ì•± ìƒì„±
   - í™˜ê²½ë³€ìˆ˜ ì„¤ì •
   - ë¯¸ë“¤ì›¨ì–´ êµ¬ì„±

5. **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„** (1ì¼)
   ```typescript
   // schema.ts
   export const diagrams = pgTable('diagrams', {
     id: uuid('id').defaultRandom().primaryKey(),
     userId: text('user_id').notNull(),
     title: text('title').notNull(),
     description: text('description'),
     bpmnXml: text('bpmn_xml').notNull(),
     thumbnail: text('thumbnail'),
     createdAt: timestamp('created_at').defaultNow(),
     updatedAt: timestamp('updated_at').defaultNow(),
   });
   ```

6. **Git ì €ì¥ì†Œ ì„¤ì •** (1ì¼)
   - .gitignore ì„¤ì •
   - ì´ˆê¸° ì»¤ë°‹
   - develop ë¸Œëœì¹˜ ìƒì„±

**ì™„ë£Œ ê¸°ì¤€**: `npm run dev`ë¡œ ë¡œì»¬ ì„œë²„ ì‹¤í–‰ ê°€ëŠ¥, Clerk ë¡œê·¸ì¸ ë™ì‘

---

#### Phase 2: ì¸ì¦ ë° ëŒ€ì‹œë³´ë“œ (1ì£¼)
**ëª©í‘œ**: ì‚¬ìš©ì ì¸ì¦ ë° ë‹¤ì´ì–´ê·¸ë¨ ëª©ë¡ í™”ë©´

**íƒœìŠ¤í¬**:
1. **ëœë”© í˜ì´ì§€** (1ì¼)
   - íˆì–´ë¡œ ì„¹ì…˜
   - ì£¼ìš” ê¸°ëŠ¥ ì†Œê°œ
   - CTA ë²„íŠ¼

2. **ì¸ì¦ í”Œë¡œìš°** (2ì¼)
   - ë¡œê·¸ì¸/íšŒì›ê°€ì… í˜ì´ì§€
   - ë¯¸ë“¤ì›¨ì–´ ë³´í˜¸ëœ ë¼ìš°íŠ¸
   - ì‚¬ìš©ì í”„ë¡œí•„ í˜ì´ì§€

3. **ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ** (2ì¼)
   - ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜
   - ìƒë‹¨ í—¤ë” (ì‚¬ìš©ì ë©”ë‰´)
   - ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ

4. **ë‹¤ì´ì–´ê·¸ë¨ ëª©ë¡** (2ì¼)
   - ê·¸ë¦¬ë“œ/ë¦¬ìŠ¤íŠ¸ ë·°
   - ê²€ìƒ‰ ê¸°ëŠ¥
   - ì •ë ¬ (ìµœì‹ ìˆœ, ì´ë¦„ìˆœ)
   - í˜ì´ì§€ë„¤ì´ì…˜

**ì˜ì¡´ì„±**: Phase 1 ì™„ë£Œ
**ì™„ë£Œ ê¸°ì¤€**: ë¡œê·¸ì¸ í›„ ë¹ˆ ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ê°€ëŠ¥

---

#### Phase 3: BPMN ì—ë””í„° ì½”ì–´ (2ì£¼)
**ëª©í‘œ**: ê¸°ë³¸ BPMN ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ë° í¸ì§‘

**íƒœìŠ¤í¬**:
1. **bpmn-js í†µí•©** (3ì¼)
   ```typescript
   // components/bpmn-editor.tsx
   'use client';
   
   import BpmnModeler from 'bpmn-js/lib/Modeler';
   import { useEffect, useRef } from 'react';
   
   export function BpmnEditor() {
     const containerRef = useRef<HTMLDivElement>(null);
     const modelerRef = useRef<BpmnModeler | null>(null);
     
     useEffect(() => {
       if (containerRef.current && !modelerRef.current) {
         modelerRef.current = new BpmnModeler({
           container: containerRef.current,
         });
         
         modelerRef.current.createDiagram();
       }
     }, []);
     
     return <div ref={containerRef} className="h-full" />;
   }
   ```

2. **ì—ë””í„° UI êµ¬ì„±** (2ì¼)
   - ìƒë‹¨ íˆ´ë°” (ì €ì¥, ë‚´ë³´ë‚´ê¸°, ë˜ëŒë¦¬ê¸°)
   - ì™¼ìª½ íŒ”ë ˆíŠ¸ (ìš”ì†Œ ì„ íƒ)
   - ì˜¤ë¥¸ìª½ ì†ì„± íŒ¨ë„
   - ìº”ë²„ìŠ¤ ì˜ì—­

3. **ë“œë˜ê·¸ ì•¤ ë“œë¡­** (2ì¼)
   - íŒ”ë ˆíŠ¸ì—ì„œ ìº”ë²„ìŠ¤ë¡œ ìš”ì†Œ ë“œë˜ê·¸
   - ìš”ì†Œ ì´ë™ ë° í¬ê¸° ì¡°ì •
   - ì—°ê²°ì„  ê·¸ë¦¬ê¸°

4. **ìš”ì†Œ ì¶”ê°€/ì‚­ì œ** (2ì¼)
   - íƒœìŠ¤í¬, ê²Œì´íŠ¸ì›¨ì´, ì´ë²¤íŠ¸ ì¶”ê°€
   - ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´
   - í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (Delete í‚¤)

5. **ì†ì„± í¸ì§‘** (2ì¼)
   - ì†ì„± íŒ¨ë„ UI
   - ì´ë¦„, ì„¤ëª… í¸ì§‘
   - ì‹¤ì‹œê°„ ë™ê¸°í™”

6. **ìº”ë²„ìŠ¤ ì¡°ì‘** (1ì¼)
   - ì¤Œ ì¸/ì•„ì›ƒ
   - íŒ¨ë‹ (ë“œë˜ê·¸ë¡œ ì´ë™)
   - ë¯¸ë‹ˆë§µ (ì„ íƒì‚¬í•­)

**ì˜ì¡´ì„±**: Phase 2 ì™„ë£Œ
**ì™„ë£Œ ê¸°ì¤€**: ê¸°ë³¸ BPMN ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ë° í¸ì§‘ ê°€ëŠ¥

---

#### Phase 4: ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸° (1ì£¼)
**ëª©í‘œ**: ë‹¤ì´ì–´ê·¸ë¨ ì˜êµ¬ ì €ì¥ ë° ê´€ë¦¬

**íƒœìŠ¤í¬**:
1. **ìë™ ì €ì¥ ê¸°ëŠ¥** (2ì¼)
   ```typescript
   // hooks/use-auto-save.ts
   import { useEffect, useRef } from 'react';
   import { debounce } from 'lodash-es';
   
   export function useAutoSave(
     xml: string,
     diagramId: string,
     onSave: (xml: string) => Promise<void>
   ) {
     const debouncedSave = useRef(
       debounce(async (xmlContent: string) => {
         await onSave(xmlContent);
       }, 3000)
     ).current;
     
     useEffect(() => {
       if (xml) {
         debouncedSave(xml);
       }
     }, [xml, debouncedSave]);
   }
   ```

2. **API ë¼ìš°íŠ¸ êµ¬í˜„** (2ì¼)
   ```typescript
   // app/api/diagrams/route.ts
   export async function POST(req: Request) {
     const { userId } = auth();
     if (!userId) return new Response('Unauthorized', { status: 401 });
     
     const body = await req.json();
     const validated = diagramSchema.parse(body);
     
     const diagram = await db.insert(diagrams).values({
       userId,
       ...validated,
     }).returning();
     
     return Response.json(diagram);
   }
   ```

3. **ë‹¤ì´ì–´ê·¸ë¨ ì—´ê¸°** (2ì¼)
   - DBì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
   - bpmn-jsì— ë¡œë“œ
   - ì—ëŸ¬ ì²˜ë¦¬

4. **ë²„ì „ íˆìŠ¤í† ë¦¬ (ì„ íƒì‚¬í•­)** (1ì¼)
   - ë³€ê²½ íˆìŠ¤í† ë¦¬ í…Œì´ë¸”
   - íƒ€ì„ë¼ì¸ UI
   - ë¡¤ë°± ê¸°ëŠ¥

**ì˜ì¡´ì„±**: Phase 3 ì™„ë£Œ
**ì™„ë£Œ ê¸°ì¤€**: ë‹¤ì´ì–´ê·¸ë¨ ì €ì¥ í›„ ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€ë¨

---

#### Phase 5: ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° (1ì£¼)
**ëª©í‘œ**: ë‹¤ì´ì–´ê·¸ë¨ íŒŒì¼ ì²˜ë¦¬

**íƒœìŠ¤í¬**:
1. **BPMN XML ë‚´ë³´ë‚´ê¸°** (1ì¼)
   ```typescript
   async function exportBpmn() {
     const { xml } = await modeler.saveXML({ format: true });
     const blob = new Blob([xml], { type: 'application/xml' });
     downloadFile(blob, 'diagram.bpmn');
   }
   ```

2. **ì´ë¯¸ì§€ ë‚´ë³´ë‚´ê¸°** (2ì¼)
   ```typescript
   async function exportPng() {
     const { svg } = await modeler.saveSVG();
     const canvas = await svgToCanvas(svg);
     const blob = await canvasToBlob(canvas);
     downloadFile(blob, 'diagram.png');
   }
   ```

3. **BPMN íŒŒì¼ ê°€ì ¸ì˜¤ê¸°** (2ì¼)
   - íŒŒì¼ ì—…ë¡œë“œ UI
   - XML íŒŒì‹±
   - ìœ íš¨ì„± ê²€ì‚¬

4. **í…œí”Œë¦¿ ì‹œìŠ¤í…œ** (2ì¼)
   - ì‚¬ì „ ì •ì˜ í…œí”Œë¦¿ (ì‹í’ˆ ì œì¡° ê³µì •)
   - í…œí”Œë¦¿ ê°¤ëŸ¬ë¦¬ UI
   - í…œí”Œë¦¿ì—ì„œ ìƒˆ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±

**ì˜ì¡´ì„±**: Phase 4 ì™„ë£Œ
**ì™„ë£Œ ê¸°ì¤€**: BPMN íŒŒì¼ ë° ì´ë¯¸ì§€ ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° ê°€ëŠ¥

---

#### Phase 6: UI/UX ê°œì„  (1ì£¼)
**ëª©í‘œ**: ì‚¬ìš©ì ê²½í—˜ ìµœì í™”

**íƒœìŠ¤í¬**:
1. **ë¡œë”© ìƒíƒœ** (1ì¼)
   - Skeleton UI
   - ìŠ¤í”¼ë„ˆ
   - í”„ë¡œê·¸ë ˆìŠ¤ ë°”

2. **ì—ëŸ¬ ì²˜ë¦¬** (1ì¼)
   - ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€
   - ì—ëŸ¬ ë°”ìš´ë”ë¦¬
   - ì¬ì‹œë„ ë¡œì§

3. **í† ìŠ¤íŠ¸ ì•Œë¦¼** (1ì¼)
   - ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€
   - shadcn/ui Toast ì»´í¬ë„ŒíŠ¸

4. **í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤** (1ì¼)
   - Ctrl+S: ì €ì¥
   - Ctrl+Z: ë˜ëŒë¦¬ê¸°
   - Delete: ì‚­ì œ

5. **ë‹¤í¬ ëª¨ë“œ** (1ì¼)
   - í…Œë§ˆ í† ê¸€
   - ì‹œìŠ¤í…œ ì„¤ì • ê°ì§€

6. **ë°˜ì‘í˜• ë””ìì¸** (2ì¼)
   - ëª¨ë°”ì¼ ë ˆì´ì•„ì›ƒ
   - íƒœë¸”ë¦¿ ìµœì í™”

**ì˜ì¡´ì„±**: Phase 5 ì™„ë£Œ
**ì™„ë£Œ ê¸°ì¤€**: ëª¨ë“  ë””ë°”ì´ìŠ¤ì—ì„œ ì›í™œí•œ ì‚¬ìš© ê²½í—˜

---

#### Phase 7: í…ŒìŠ¤íŠ¸ ë° ìµœì í™” (1ì£¼)
**ëª©í‘œ**: í’ˆì§ˆ ë³´ì¦ ë° ì„±ëŠ¥ ê°œì„ 

**íƒœìŠ¤í¬**:
1. **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸** (2ì¼)
   - ìœ í‹¸ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
   - ì»¤ìŠ¤í…€ í›… í…ŒìŠ¤íŠ¸
   - ìµœì†Œ 80% ì»¤ë²„ë¦¬ì§€

2. **E2E í…ŒìŠ¤íŠ¸** (2ì¼)
   - ì£¼ìš” ì‚¬ìš©ì í”Œë¡œìš°
   - íšŒì›ê°€ì… â†’ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± â†’ ì €ì¥

3. **ì„±ëŠ¥ ìµœì í™”** (2ì¼)
   - Lighthouse ì ìˆ˜ 90+ ëª©í‘œ
   - ë²ˆë“¤ ì‚¬ì´ì¦ˆ ë¶„ì„
   - ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…

4. **ì ‘ê·¼ì„± ê²€ì‚¬** (1ì¼)
   - axe DevTools ê²€ì‚¬
   - í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ í…ŒìŠ¤íŠ¸
   - ìŠ¤í¬ë¦° ë¦¬ë” í…ŒìŠ¤íŠ¸

**ì˜ì¡´ì„±**: Phase 6 ì™„ë£Œ
**ì™„ë£Œ ê¸°ì¤€**: ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼, Lighthouse ì ìˆ˜ 90+

---

#### Phase 8: ë°°í¬ ë° ëª¨ë‹ˆí„°ë§ (1ì£¼)
**ëª©í‘œ**: í”„ë¡œë•ì…˜ ë°°í¬ ë° ì•ˆì •í™”

**íƒœìŠ¤í¬**:
1. **í”„ë¡œë•ì…˜ í™˜ê²½ë³€ìˆ˜** (1ì¼)
   - Vercel í™˜ê²½ë³€ìˆ˜ ì„¤ì •
   - ì‹œí¬ë¦¿ í‚¤ ë¡œí…Œì´ì…˜

2. **í”„ë¡œë•ì…˜ ë°°í¬** (1ì¼)
   - Vercelì— ë°°í¬
   - ë„ë©”ì¸ ì—°ê²° (ì„ íƒì‚¬í•­)

3. **ëª¨ë‹ˆí„°ë§ ì„¤ì •** (1ì¼)
   - Vercel Analytics
   - Sentry ì—ëŸ¬ íŠ¸ë˜í‚¹

4. **ë¬¸ì„œí™”** (2ì¼)
   - README ì‘ì„±
   - ì‚¬ìš©ì ê°€ì´ë“œ
   - API ë¬¸ì„œ

5. **ë² íƒ€ í…ŒìŠ¤íŠ¸** (2ì¼)
   - ì‹¤ì œ ì‚¬ìš©ì í”¼ë“œë°±
   - ë²„ê·¸ ìˆ˜ì •

**ì˜ì¡´ì„±**: Phase 7 ì™„ë£Œ
**ì™„ë£Œ ê¸°ì¤€**: í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘

---

## 6. í”„ë¡ íŠ¸ì—”ë“œ ê°€ì´ë“œë¼ì¸

### 6.1 ë””ìì¸ ì›ì¹™

#### ì¼ê´€ì„±
- ëª¨ë“  í˜ì´ì§€ì—ì„œ ë™ì¼í•œ ì»´í¬ë„ŒíŠ¸ì™€ ìŠ¤íƒ€ì¼ ì‚¬ìš©
- shadcn/ui ì»´í¬ë„ŒíŠ¸ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©
- ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ì¼ê´€ì„± ìœ ì§€

#### ë°˜ì‘ì„±
```typescript
// Tailwind breakpoints
// sm: 640px
// md: 768px
// lg: 1024px
// xl: 1280px
// 2xl: 1536px

<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
  {/* ëª¨ë°”ì¼: 1ì—´, íƒœë¸”ë¦¿: 2ì—´, ë°ìŠ¤í¬í†±: 3ì—´ */}
</div>
```

#### ì ‘ê·¼ì„±
- ëª¨ë“  ì¸í„°ë™í‹°ë¸Œ ìš”ì†ŒëŠ” í‚¤ë³´ë“œë¡œ ì ‘ê·¼ ê°€ëŠ¥
- ì¶©ë¶„í•œ ìƒ‰ìƒ ëŒ€ë¹„ (4.5:1)
- ARIA ì†ì„± ì ì ˆíˆ ì‚¬ìš©

#### ì„±ëŠ¥
- ì´ë¯¸ì§€ lazy loading
- ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…
- ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€

### 6.2 ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜

#### í´ë” êµ¬ì¡°
```
app/
â”œâ”€â”€ (auth)/
â”‚   â”œâ”€â”€ sign-in/
â”‚   â””â”€â”€ sign-up/
â”œâ”€â”€ (dashboard)/
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ editor/[id]/
â”‚   â””â”€â”€ templates/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ diagrams/
â””â”€â”€ layout.tsx

components/
â”œâ”€â”€ ui/              # shadcn/ui ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ button.tsx
â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â””â”€â”€ ...
â”œâ”€â”€ bpmn/            # BPMN ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ bpmn-editor.tsx
â”‚   â”œâ”€â”€ bpmn-palette.tsx
â”‚   â””â”€â”€ bpmn-properties.tsx
â”œâ”€â”€ dashboard/       # ëŒ€ì‹œë³´ë“œ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ diagram-card.tsx
â”‚   â””â”€â”€ diagram-grid.tsx
â””â”€â”€ layout/          # ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
    â”œâ”€â”€ header.tsx
    â””â”€â”€ sidebar.tsx

lib/
â”œâ”€â”€ db/              # ë°ì´í„°ë² ì´ìŠ¤
â”‚   â”œâ”€â”€ schema.ts
â”‚   â””â”€â”€ queries.ts
â”œâ”€â”€ utils/           # ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ bpmn.ts
â””â”€â”€ hooks/           # ì»¤ìŠ¤í…€ í›…
    â””â”€â”€ use-auto-save.ts
```

#### ì»´í¬ë„ŒíŠ¸ íŒ¨í„´

**1. Server Components (ê¸°ë³¸ê°’)**
```typescript
// app/dashboard/page.tsx
// ë°ì´í„° í˜ì¹­ì€ ì„œë²„ì—ì„œ
import { auth } from '@clerk/nextjs';
import { db } from '@/lib/db';

export default async function DashboardPage() {
  const { userId } = auth();
  const diagrams = await db.query.diagrams.findMany({
    where: eq(diagrams.userId, userId!),
  });
  
  return <DiagramGrid diagrams={diagrams} />;
}
```

**2. Client Components**
```typescript
// components/bpmn/bpmn-editor.tsx
'use client';

import { useState, useEffect } from 'react';
import BpmnModeler from 'bpmn-js/lib/Modeler';

export function BpmnEditor({ initialXml }: { initialXml?: string }) {
  const [modeler, setModeler] = useState<BpmnModeler | null>(null);
  
  // í´ë¼ì´ì–¸íŠ¸ ì „ìš© ë¡œì§
  useEffect(() => {
    // bpmn-js ì´ˆê¸°í™”
  }, []);
  
  return <div id="canvas" />;
}
```

**3. ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬ ì›ì¹™**
- í•œ ì»´í¬ë„ŒíŠ¸ëŠ” í•˜ë‚˜ì˜ ì±…ì„ë§Œ
- 200ì¤„ ì´ìƒì´ë©´ ë¶„ë¦¬ ê³ ë ¤
- propsëŠ” 5ê°œ ì´í•˜ë¡œ ìœ ì§€

### 6.3 ìƒíƒœ ê´€ë¦¬

#### Zustand Store
```typescript
// lib/stores/editor-store.ts
import { create } from 'zustand';

interface EditorState {
  isDirty: boolean;
  currentDiagram: Diagram | null;
  setDirty: (dirty: boolean) => void;
  setCurrentDiagram: (diagram: Diagram) => void;
}

export const useEditorStore = create<EditorState>((set) => ({
  isDirty: false,
  currentDiagram: null,
  setDirty: (dirty) => set({ isDirty: dirty }),
  setCurrentDiagram: (diagram) => set({ currentDiagram: diagram }),
}));
```

#### ì‚¬ìš© ì˜ˆì‹œ
```typescript
'use client';

import { useEditorStore } from '@/lib/stores/editor-store';

export function SaveButton() {
  const isDirty = useEditorStore((state) => state.isDirty);
  
  return (
    <Button disabled={!isDirty}>
      ì €ì¥
    </Button>
  );
}
```

### 6.4 ìŠ¤íƒ€ì¼ë§

#### Tailwind CSS í™œìš©
```typescript
// âœ… ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ìŠ¤íƒ€ì¼
const buttonVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        outline: "border border-input hover:bg-accent",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 px-3",
        lg: "h-11 px-8",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
);
```

#### CSS ë³€ìˆ˜ (í…Œë§ˆ)
```css
/* app/globals.css */
@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --primary: 221.2 83.2% 53.3%;
    --primary-foreground: 210 40% 98%;
    /* ... */
  }
  
  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    /* ... */
  }
}
```

### 6.5 ì„±ëŠ¥ ìµœì í™”

#### ë™ì  Import
```typescript
// í° ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë™ì  ë¡œë“œ
const BpmnEditor = dynamic(
  () => import('@/components/bpmn/bpmn-editor'),
  { 
    ssr: false,
    loading: () => <EditorSkeleton />
  }
);
```

#### ì´ë¯¸ì§€ ìµœì í™”
```typescript
import Image from 'next/image';

<Image
  src={diagram.thumbnail}
  alt={diagram.title}
  width={400}
  height={300}
  placeholder="blur"
  blurDataURL={diagram.blurHash}
/>
```

#### ë©”ëª¨ì´ì œì´ì…˜ (ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ìì„¸íˆ)

---

## 7. ë°±ì—”ë“œ ê°€ì´ë“œë¼ì¸

### 7.1 ì„œë²„ ì•„í‚¤í…ì²˜

#### API Routes êµ¬ì¡°
```
app/api/
â”œâ”€â”€ diagrams/
â”‚   â”œâ”€â”€ route.ts              # GET, POST /api/diagrams
â”‚   â”œâ”€â”€ [id]/
â”‚   â”‚   â”œâ”€â”€ route.ts          # GET, PATCH, DELETE /api/diagrams/[id]
â”‚   â”‚   â””â”€â”€ versions/
â”‚   â”‚       â””â”€â”€ route.ts      # GET /api/diagrams/[id]/versions
â”‚   â””â”€â”€ export/
â”‚       â””â”€â”€ route.ts          # POST /api/diagrams/export
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ route.ts              # GET /api/templates
â””â”€â”€ upload/
    â””â”€â”€ route.ts              # POST /api/upload
```

### 7.2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

#### Drizzle ORM ìŠ¤í‚¤ë§ˆ
```typescript
// lib/db/schema.ts
import { pgTable, uuid, text, timestamp, jsonb } from 'drizzle-orm/pg-core';

// ë‹¤ì´ì–´ê·¸ë¨ í…Œì´ë¸”
export const diagrams = pgTable('diagrams', {
  id: uuid('id').defaultRandom().primaryKey(),
  userId: text('user_id').notNull(),
  title: text('title').notNull(),
  description: text('description'),
  bpmnXml: text('bpmn_xml').notNull(), // BPMN XML ì „ì²´ ì €ì¥
  thumbnail: text('thumbnail'), // ì¸ë„¤ì¼ ì´ë¯¸ì§€ URL (Vercel Blob)
  tags: text('tags').array(), // íƒœê·¸ ë°°ì—´
  isTemplate: boolean('is_template').default(false),
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
});

// ë²„ì „ íˆìŠ¤í† ë¦¬ í…Œì´ë¸” (ì„ íƒì‚¬í•­)
export const diagramVersions = pgTable('diagram_versions', {
  id: uuid('id').defaultRandom().primaryKey(),
  diagramId: uuid('diagram_id').references(() => diagrams.id, { onDelete: 'cascade' }),
  bpmnXml: text('bpmn_xml').notNull(),
  createdBy: text('created_by').notNull(),
  createdAt: timestamp('created_at').defaultNow().notNull(),
  changeDescription: text('change_description'),
});

// ê³µìœ  ì„¤ì • í…Œì´ë¸” (ë¯¸ë˜ ê¸°ëŠ¥)
export const diagramShares = pgTable('diagram_shares', {
  id: uuid('id').defaultRandom().primaryKey(),
  diagramId: uuid('diagram_id').references(() => diagrams.id, { onDelete: 'cascade' }),
  sharedWithUserId: text('shared_with_user_id').notNull(),
  permission: text('permission').notNull(), // 'view' | 'edit'
  createdAt: timestamp('created_at').defaultNow().notNull(),
});
```

#### ë§ˆì´ê·¸ë ˆì´ì…˜
```typescript
// drizzle.config.ts
import type { Config } from 'drizzle-kit';

export default {
  schema: './lib/db/schema.ts',
  out: './drizzle',
  driver: 'pg',
  dbCredentials: {
    connectionString: process.env.POSTGRES_URL!,
  },
} satisfies Config;
```

```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
npx drizzle-kit generate:pg

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
npx drizzle-kit push:pg
```

### 7.3 API ì„¤ê³„

#### RESTful API ê·œì¹™
```
GET     /api/diagrams          # ëª©ë¡ ì¡°íšŒ
POST    /api/diagrams          # ìƒˆ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±
GET     /api/diagrams/[id]     # ë‹¨ì¼ ì¡°íšŒ
PATCH   /api/diagrams/[id]     # ìˆ˜ì •
DELETE  /api/diagrams/[id]     # ì‚­ì œ
```

#### API Route êµ¬í˜„ ì˜ˆì‹œ
```typescript
// app/api/diagrams/route.ts
import { auth } from '@clerk/nextjs';
import { db } from '@/lib/db';
import { diagrams } from '@/lib/db/schema';
import { z } from 'zod';
import { eq } from 'drizzle-orm';

// ìš”ì²­ ê²€ì¦ ìŠ¤í‚¤ë§ˆ
const createDiagramSchema = z.object({
  title: z.string().min(1).max(100),
  description: z.string().max(500).optional(),
  bpmnXml: z.string().min(1),
  tags: z.array(z.string()).optional(),
});

// GET /api/diagrams - ëª©ë¡ ì¡°íšŒ
export async function GET(req: Request) {
  try {
    const { userId } = auth();
    
    // ğŸ”’ ì¸ì¦ ì²´í¬
    if (!userId) {
      return Response.json(
        { error: 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.' },
        { status: 401 }
      );
    }
    
    // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° íŒŒì‹±
    const { searchParams } = new URL(req.url);
    const page = parseInt(searchParams.get('page') || '1');
    const limit = parseInt(searchParams.get('limit') || '10');
    const search = searchParams.get('search') || '';
    
    // DB ì¿¼ë¦¬
    const userDiagrams = await db.query.diagrams.findMany({
      where: (diagrams, { eq, and, ilike }) => and(
        eq(diagrams.userId, userId),
        search ? ilike(diagrams.title, `%${search}%`) : undefined
      ),
      limit,
      offset: (page - 1) * limit,
      orderBy: (diagrams, { desc }) => [desc(diagrams.updatedAt)],
    });
    
    return Response.json({
      data: userDiagrams,
      pagination: {
        page,
        limit,
        total: userDiagrams.length,
      },
    });
    
  } catch (error) {
    // ğŸ”’ ì—ëŸ¬ ë©”ì‹œì§€ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
    console.error('GET /api/diagrams error:', error);
    return Response.json(
      { error: 'ë‹¤ì´ì–´ê·¸ë¨ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' },
      { status: 500 }
    );
  }
}

// POST /api/diagrams - ìƒˆ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±
export async function POST(req: Request) {
  try {
    const { userId } = auth();
    
    // ğŸ”’ ì¸ì¦ ì²´í¬
    if (!userId) {
      return Response.json(
        { error: 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.' },
        { status: 401 }
      );
    }
    
    // ìš”ì²­ ë°”ë”” íŒŒì‹±
    const body = await req.json();
    
    // ğŸ”’ ì…ë ¥ ê²€ì¦
    const validated = createDiagramSchema.safeParse(body);
    if (!validated.success) {
      return Response.json(
        { error: 'ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤.', details: validated.error.errors },
        { status: 400 }
      );
    }
    
    // DBì— ì €ì¥
    const [newDiagram] = await db.insert(diagrams).values({
      userId,
      title: validated.data.title,
      description: validated.data.description,
      bpmnXml: validated.data.bpmnXml,
      tags: validated.data.tags,
    }).returning();
    
    return Response.json(newDiagram, { status: 201 });
    
  } catch (error) {
    console.error('POST /api/diagrams error:', error);
    return Response.json(
      { error: 'ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' },
      { status: 500 }
    );
  }
}
```

#### PATCH êµ¬í˜„ (ë¶€ë¶„ ì—…ë°ì´íŠ¸)
```typescript
// app/api/diagrams/[id]/route.ts
export async function PATCH(
  req: Request,
  { params }: { params: { id: string } }
) {
  try {
    const { userId } = auth();
    if (!userId) {
      return Response.json({ error: 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.' }, { status: 401 });
    }
    
    const { id } = params;
    const body = await req.json();
    
    // ë‹¤ì´ì–´ê·¸ë¨ ì†Œìœ ê¶Œ í™•ì¸
    const diagram = await db.query.diagrams.findFirst({
      where: (diagrams, { eq, and }) => and(
        eq(diagrams.id, id),
        eq(diagrams.userId, userId)
      ),
    });
    
    if (!diagram) {
      return Response.json(
        { error: 'ë‹¤ì´ì–´ê·¸ë¨ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },
        { status: 404 }
      );
    }
    
    // ì—…ë°ì´íŠ¸
    const [updated] = await db.update(diagrams)
      .set({
        ...body,
        updatedAt: new Date(),
      })
      .where(eq(diagrams.id, id))
      .returning();
    
    return Response.json(updated);
    
  } catch (error) {
    console.error('PATCH /api/diagrams/[id] error:', error);
    return Response.json(
      { error: 'ë‹¤ì´ì–´ê·¸ë¨ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' },
      { status: 500 }
    );
  }
}
```

### 7.4 ì¸ì¦ ë° ê¶Œí•œ

#### Clerk ë¯¸ë“¤ì›¨ì–´
```typescript
// middleware.ts
import { authMiddleware } from '@clerk/nextjs';

export default authMiddleware({
  // ê³µê°œ ë¼ìš°íŠ¸
  publicRoutes: [
    '/',
    '/sign-in(.*)',
    '/sign-up(.*)',
    '/api/webhooks(.*)',
  ],
  
  // API ë¼ìš°íŠ¸ ë³´í˜¸
  apiRoutes: ['/api(.*)'],
});

export const config = {
  matcher: ['/((?!.+\\.[\\w]+$|_next).*)', '/', '/(api|trpc)(.*)'],
};
```

#### ê¶Œí•œ ì²´í¬ í—¬í¼
```typescript
// lib/auth/permissions.ts
import { auth } from '@clerk/nextjs';
import { db } from '@/lib/db';
import { diagrams } from '@/lib/db/schema';
import { eq } from 'drizzle-orm';

export async function canAccessDiagram(diagramId: string) {
  const { userId } = auth();
  if (!userId) return false;
  
  const diagram = await db.query.diagrams.findFirst({
    where: eq(diagrams.id, diagramId),
  });
  
  if (!diagram) return false;
  
  // ì†Œìœ ìì´ê±°ë‚˜ ê³µìœ ë°›ì€ ê²½ìš°
  return diagram.userId === userId;
  // ì¶”í›„: || await isSharedWith(diagramId, userId);
}
```

### 7.5 ë³´ì•ˆ ì¡°ì¹˜

#### ğŸ”’ í•„ìˆ˜ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

**1. í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬**
```bash
# .env.local (ì ˆëŒ€ ì»¤ë°‹í•˜ì§€ ì•ŠìŒ!)
POSTGRES_URL="postgresql://..."
POSTGRES_URL_NON_POOLING="postgresql://..."

NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY="pk_test_..."
CLERK_SECRET_KEY="sk_test_..."  # ğŸ”’ ì ˆëŒ€ NEXT_PUBLIC_ ì ‘ë‘ì‚¬ ì‚¬ìš© ê¸ˆì§€

BLOB_READ_WRITE_TOKEN="vercel_blob_..."
```

```bash
# .env.example (ì»¤ë°‹ ê°€ëŠ¥)
POSTGRES_URL=your_postgres_url
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=your_clerk_key
CLERK_SECRET_KEY=your_clerk_secret
```

**2. ì…ë ¥ ê²€ì¦ (Zod)**
```typescript
// ëª¨ë“  ì‚¬ìš©ì ì…ë ¥ì€ ê²€ì¦ í•„ìˆ˜
const schema = z.object({
  title: z.string().min(1).max(100),
  bpmnXml: z.string().min(1).max(1000000), // 1MB ì œí•œ
});

const result = schema.safeParse(input);
if (!result.success) {
  return Response.json(
    { error: 'ì˜ëª»ëœ ì…ë ¥ì…ë‹ˆë‹¤.' },
    { status: 400 }
  );
}
```

**3. SQL Injection ë°©ì§€ (ORM ì‚¬ìš©)**
```typescript
// âœ… Drizzle ORM ì‚¬ìš© (ì•ˆì „)
const diagrams = await db.query.diagrams.findMany({
  where: eq(diagrams.userId, userId),
});

// âŒ ì ˆëŒ€ ì§ì ‘ SQL ë¬¸ìì—´ ì¡°í•© ê¸ˆì§€
// const query = `SELECT * FROM diagrams WHERE user_id = '${userId}'`; // ìœ„í—˜!
```

**4. Rate Limiting (ì„ íƒì‚¬í•­)**
```typescript
// lib/rate-limit.ts
import { Ratelimit } from '@upstash/ratelimit';
import { Redis } from '@upstash/redis';

const ratelimit = new Ratelimit({
  redis: Redis.fromEnv(),
  limiter: Ratelimit.slidingWindow(10, '10 s'), // 10ì´ˆì— 10ê°œ ìš”ì²­
});

export async function checkRateLimit(userId: string) {
  const { success } = await ratelimit.limit(userId);
  return success;
}
```

**5. CORS ì„¤ì •**
```typescript
// Next.js APIì—ì„œ CORS í—¤ë” ì„¤ì •
export async function GET(req: Request) {
  const response = Response.json({ data: '...' });
  
  // Vercel ë°°í¬ í™˜ê²½ì—ì„œëŠ” ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ì§€ë§Œ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì • ê°€ëŠ¥
  response.headers.set('Access-Control-Allow-Origin', 'https://yourdomain.com');
  response.headers.set('Access-Control-Allow-Methods', 'GET, POST, PATCH, DELETE');
  
  return response;
}
```

### 7.6 ìºì‹± ì „ëµ

#### Next.js ìºì‹±
```typescript
// ì •ì  ë°ì´í„° ìºì‹± (í…œí”Œë¦¿)
export const revalidate = 3600; // 1ì‹œê°„

export async function GET() {
  const templates = await db.query.diagrams.findMany({
    where: eq(diagrams.isTemplate, true),
  });
  
  return Response.json(templates);
}
```

#### ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”
```typescript
// í•„ìš”í•œ í•„ë“œë§Œ ì„ íƒ
const diagrams = await db.select({
  id: diagrams.id,
  title: diagrams.title,
  thumbnail: diagrams.thumbnail,
  updatedAt: diagrams.updatedAt,
}).from(diagrams)
  .where(eq(diagrams.userId, userId));
```

---

## 8. ìµœì í™”ëœ React ì½”ë“œ ê°€ì´ë“œë¼ì¸

### 8.1 ì¼ë°˜ì ì¸ ì„±ëŠ¥ í•¨ì •

#### âŒ ë¬¸ì œ 1: ì¸ë¼ì¸ ê°ì²´/í•¨ìˆ˜ë¡œ ì¸í•œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”
```typescript
// âŒ ë‚˜ìœ ì˜ˆ: ë§¤ ë Œë”ë§ˆë‹¤ ìƒˆë¡œìš´ ê°ì²´/í•¨ìˆ˜ ìƒì„±
function DiagramCard({ diagram }) {
  return (
    <Card
      style={{ padding: 16, margin: 8 }}  // ë§¤ë²ˆ ìƒˆ ê°ì²´
      onClick={() => navigateToDiagram(diagram.id)}  // ë§¤ë²ˆ ìƒˆ í•¨ìˆ˜
    >
      {diagram.title}
    </Card>
  );
}
```

```typescript
// âœ… ì¢‹ì€ ì˜ˆ: ë©”ëª¨ì´ì œì´ì…˜ í™œìš©
const cardStyle = { padding: 16, margin: 8 }; // ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€

function DiagramCard({ diagram }) {
  const handleClick = useCallback(() => {
    navigateToDiagram(diagram.id);
  }, [diagram.id]);
  
  return (
    <Card style={cardStyle} onClick={handleClick}>
      {diagram.title}
    </Card>
  );
}
```

#### âŒ ë¬¸ì œ 2: Propsë¡œ ì¸ë¼ì¸ í•¨ìˆ˜ ì „ë‹¬
```typescript
// âŒ ë‚˜ìœ ì˜ˆ: ìì‹ ì»´í¬ë„ŒíŠ¸ê°€ ë§¤ë²ˆ ë¦¬ë Œë”ë¨
function DiagramList({ diagrams }) {
  return diagrams.map(diagram => (
    <DiagramCard
      key={diagram.id}
      diagram={diagram}
      onDelete={() => handleDelete(diagram.id)}  // ë§¤ë²ˆ ìƒˆ í•¨ìˆ˜
    />
  ));
}
```

```typescript
// âœ… ì¢‹ì€ ì˜ˆ: ìì‹ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì²˜ë¦¬
const DiagramCard = memo(function DiagramCard({ diagram, onDelete }) {
  const handleDelete = useCallback(() => {
    onDelete(diagram.id);
  }, [diagram.id, onDelete]);
  
  return (
    <Card>
      {diagram.title}
      <Button onClick={handleDelete}>ì‚­ì œ</Button>
    </Card>
  );
});
```

### 8.2 React.memo í™œìš©

#### ì–¸ì œ ì‚¬ìš©í•˜ë‚˜?
- propsê°€ ìì£¼ ë³€í•˜ì§€ ì•ŠëŠ” ì»´í¬ë„ŒíŠ¸
- ë Œë”ë§ ë¹„ìš©ì´ í° ì»´í¬ë„ŒíŠ¸
- ë¦¬ìŠ¤íŠ¸ì˜ ì•„ì´í…œ ì»´í¬ë„ŒíŠ¸

```typescript
// âœ… React.memoë¡œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë” ë°©ì§€
export const DiagramCard = memo(function DiagramCard({
  diagram,
  onSelect,
}: DiagramCardProps) {
  return (
    <div onClick={() => onSelect(diagram.id)}>
      <Image src={diagram.thumbnail} alt={diagram.title} />
      <h3>{diagram.title}</h3>
    </div>
  );
}, (prevProps, nextProps) => {
  // ì»¤ìŠ¤í…€ ë¹„êµ í•¨ìˆ˜ (ì„ íƒì‚¬í•­)
  return prevProps.diagram.id === nextProps.diagram.id &&
         prevProps.diagram.updatedAt === nextProps.diagram.updatedAt;
});
```

### 8.3 useCallback í›…

#### ì–¸ì œ ì‚¬ìš©í•˜ë‚˜?
- ìì‹ ì»´í¬ë„ŒíŠ¸ì— í•¨ìˆ˜ë¥¼ propìœ¼ë¡œ ì „ë‹¬í•  ë•Œ
- useEffectì˜ ì˜ì¡´ì„± ë°°ì—´ì— í•¨ìˆ˜ê°€ ë“¤ì–´ê°ˆ ë•Œ

```typescript
function DiagramEditor({ diagramId }) {
  const [xml, setXml] = useState('');
  
  // âœ… useCallbackìœ¼ë¡œ í•¨ìˆ˜ ë©”ëª¨ì´ì œì´ì…˜
  const handleSave = useCallback(async () => {
    await saveDiagram(diagramId, xml);
  }, [diagramId, xml]); // ì˜ì¡´ì„±ì´ ë³€í•  ë•Œë§Œ ìƒˆ í•¨ìˆ˜ ìƒì„±
  
  // âœ… ìì‹ ì»´í¬ë„ŒíŠ¸ì— ì•ˆì „í•˜ê²Œ ì „ë‹¬
  return (
    <div>
      <BpmnCanvas onXmlChange={setXml} />
      <SaveButton onClick={handleSave} />
    </div>
  );
}
```

### 8.4 useMemo í›…

#### ì–¸ì œ ì‚¬ìš©í•˜ë‚˜?
- ê³„ì‚° ë¹„ìš©ì´ í° ì—°ì‚° ê²°ê³¼ë¥¼ ìºì‹±
- ê°ì²´ë‚˜ ë°°ì—´ì„ ì˜ì¡´ì„±ìœ¼ë¡œ ì‚¬ìš©í•  ë•Œ

```typescript
function DiagramList({ diagrams, searchTerm }) {
  // âœ… í•„í„°ë§ ê²°ê³¼ ë©”ëª¨ì´ì œì´ì…˜
  const filteredDiagrams = useMemo(() => {
    return diagrams.filter(d => 
      d.title.toLowerCase().includes(searchTerm.toLowerCase())
    );
  }, [diagrams, searchTerm]); // diagramsë‚˜ searchTermì´ ë³€í•  ë•Œë§Œ ì¬ê³„ì‚°
  
  // âœ… ë³µì¡í•œ í†µê³„ ê³„ì‚° ë©”ëª¨ì´ì œì´ì…˜
  const stats = useMemo(() => {
    return {
      total: diagrams.length,
      recent: diagrams.filter(d => isRecent(d.createdAt)).length,
      byTag: groupBy(diagrams, 'tags'),
    };
  }, [diagrams]);
  
  return (
    <div>
      <Stats data={stats} />
      {filteredDiagrams.map(d => <DiagramCard key={d.id} diagram={d} />)}
    </div>
  );
}
```

### 8.5 ì‹¤ì „ ì˜ˆì œ: BPMN ì—ë””í„° ìµœì í™”

#### âŒ ìµœì í™” ì „ (ë¬¸ì œ ë§ìŒ)
```typescript
function BpmnEditor({ diagramId }) {
  const [xml, setXml] = useState('');
  const [modeler, setModeler] = useState(null);
  
  // âŒ ë§¤ ë Œë”ë§ˆë‹¤ ìƒˆ í•¨ìˆ˜ ìƒì„±
  const handleElementClick = (event) => {
    const element = event.element;
    showPropertiesPanel(element);
  };
  
  // âŒ ë§¤ ë Œë”ë§ˆë‹¤ ìƒˆ ì„¤ì • ê°ì²´
  const editorConfig = {
    container: '#canvas',
    keyboard: { bindTo: window },
  };
  
  useEffect(() => {
    const modeler = new BpmnModeler(editorConfig); // âŒ ì˜ì¡´ì„± ë¬¸ì œ
    modeler.on('element.click', handleElementClick); // âŒ ì˜ì¡´ì„± ë¬¸ì œ
    setModeler(modeler);
  }, []); // âŒ ì˜ì¡´ì„± ëˆ„ë½
  
  return <div id="canvas" />;
}
```

#### âœ… ìµœì í™” í›„ (ì˜¬ë°”ë¥¸ íŒ¨í„´)
```typescript
function BpmnEditor({ diagramId }) {
  const [xml, setXml] = useState('');
  const [modeler, setModeler] = useState<BpmnModeler | null>(null);
  const containerRef = useRef<HTMLDivElement>(null);
  
  // âœ… ì„¤ì • ê°ì²´ ë©”ëª¨ì´ì œì´ì…˜
  const editorConfig = useMemo(() => ({
    container: containerRef.current,
    keyboard: { bindTo: window },
  }), []); // í•œ ë²ˆë§Œ ìƒì„±
  
  // âœ… ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë©”ëª¨ì´ì œì´ì…˜
  const handleElementClick = useCallback((event: any) => {
    const element = event.element;
    showPropertiesPanel(element);
  }, []); // ì˜ì¡´ì„± ì—†ìœ¼ë©´ í•œ ë²ˆë§Œ ìƒì„±
  
  // âœ… ëª¨ë“  ì˜ì¡´ì„± ëª…ì‹œ
  useEffect(() => {
    if (!containerRef.current || modeler) return;
    
    const newModeler = new BpmnModeler(editorConfig);
    newModeler.on('element.click', handleElementClick);
    setModeler(newModeler);
    
    return () => {
      newModeler.destroy(); // âœ… í´ë¦°ì—…
    };
  }, [editorConfig, handleElementClick, modeler]);
  
  // âœ… XML ë¡œë“œ ë¡œì§ ë¶„ë¦¬
  useEffect(() => {
    if (!modeler || !xml) return;
    
    modeler.importXML(xml).catch(err => {
      console.error('Failed to load BPMN:', err);
    });
  }, [modeler, xml]);
  
  return <div ref={containerRef} className="h-full" />;
}
```

### 8.6 ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ ìµœì í™”

#### âŒ ë¹„íš¨ìœ¨ì ì¸ ë¦¬ìŠ¤íŠ¸
```typescript
function DiagramGrid({ diagrams }) {
  return (
    <div className="grid">
      {diagrams.map((diagram, index) => (
        // âŒ keyë¡œ index ì‚¬ìš© (ì•ˆì •ì ì´ì§€ ì•ŠìŒ)
        // âŒ ì¸ë¼ì¸ í•¨ìˆ˜ë¡œ prop ì „ë‹¬
        <DiagramCard
          key={index}
          diagram={diagram}
          onEdit={() => editDiagram(diagram.id)}
          onDelete={() => deleteDiagram(diagram.id)}
        />
      ))}
    </div>
  );
}
```

#### âœ… ìµœì í™”ëœ ë¦¬ìŠ¤íŠ¸
```typescript
// DiagramCardë¥¼ ë©”ëª¨ì´ì œì´ì…˜
const DiagramCard = memo(function DiagramCard({
  diagram,
  onEdit,
  onDelete,
}: DiagramCardProps) {
  // âœ… ë‚´ë¶€ì—ì„œ IDë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì²˜ë¦¬
  const handleEdit = useCallback(() => {
    onEdit(diagram.id);
  }, [diagram.id, onEdit]);
  
  const handleDelete = useCallback(() => {
    onDelete(diagram.id);
  }, [diagram.id, onDelete]);
  
  return (
    <Card>
      <Image src={diagram.thumbnail} alt={diagram.title} />
      <h3>{diagram.title}</h3>
      <Button onClick={handleEdit}>í¸ì§‘</Button>
      <Button onClick={handleDelete}>ì‚­ì œ</Button>
    </Card>
  );
});

function DiagramGrid({ diagrams }) {
  // âœ… í•¸ë“¤ëŸ¬ë¥¼ ìƒìœ„ì—ì„œ ë©”ëª¨ì´ì œì´ì…˜
  const handleEdit = useCallback((id: string) => {
    router.push(`/editor/${id}`);
  }, [router]);
  
  const handleDelete = useCallback(async (id: string) => {
    await deleteDiagram(id);
    mutate(); // SWR ì¬ê²€ì¦
  }, [mutate]);
  
  return (
    <div className="grid grid-cols-3 gap-4">
      {diagrams.map(diagram => (
        <DiagramCard
          key={diagram.id} // âœ… ì•ˆì •ì ì¸ ê³ ìœ  ID ì‚¬ìš©
          diagram={diagram}
          onEdit={handleEdit}
          onDelete={handleDelete}
        />
      ))}
    </div>
  );
}
```

### 8.7 ìƒíƒœ ì—…ë°ì´íŠ¸ ìµœì í™”

#### âŒ ë¶ˆí•„ìš”í•œ ìƒíƒœ ë¶„ë¦¬
```typescript
// âŒ ë„ˆë¬´ ë§ì€ ê°œë³„ ìƒíƒœ
function DiagramForm() {
  const [title, setTitle] = useState('');
  const [description, setDescription] = useState('');
  const [tags, setTags] = useState([]);
  const [isPublic, setIsPublic] = useState(false);
  // ... 10ê°œ ì´ìƒì˜ ìƒíƒœ
  
  // ë§¤ ìƒíƒœ ë³€ê²½ë§ˆë‹¤ ë¦¬ë Œë”
}
```

#### âœ… ê´€ë ¨ ìƒíƒœ ê·¸ë£¹í™”
```typescript
// âœ… useReducerë‚˜ ë‹¨ì¼ ê°ì²´ë¡œ ê´€ë¦¬
function DiagramForm() {
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    tags: [],
    isPublic: false,
  });
  
  // âœ… ë‹¨ì¼ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
  const updateField = useCallback((field: string, value: any) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  }, []);
  
  return (
    <form>
      <Input
        value={formData.title}
        onChange={(e) => updateField('title', e.target.value)}
      />
      {/* ... */}
    </form>
  );
}
```

### 8.8 ì»´í¬ë„ŒíŠ¸ êµ¬ì¡° ê°€ì´ë“œ

#### ì˜¬ë°”ë¥¸ ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬
```typescript
// âœ… ì‘ê³  ì§‘ì¤‘ëœ ì»´í¬ë„ŒíŠ¸
function DiagramEditor({ diagramId }: { diagramId: string }) {
  return (
    <div className="flex h-screen">
      <EditorSidebar />
      <EditorCanvas diagramId={diagramId} />
      <PropertiesPanel />
    </div>
  );
}

// âœ… ê° ë¶€ë¶„ì€ ë…ë¦½ì ìœ¼ë¡œ ìµœì í™” ê°€ëŠ¥
const EditorSidebar = memo(function EditorSidebar() {
  return <aside>{/* íŒ”ë ˆíŠ¸ */}</aside>;
});

const EditorCanvas = memo(function EditorCanvas({ diagramId }) {
  // BPMN ì—ë””í„° ë¡œì§
  return <div id="canvas" />;
});

const PropertiesPanel = memo(function PropertiesPanel() {
  // ì†ì„± í¸ì§‘ UI
  return <aside>{/* ì†ì„± */}</aside>;
});
```

---

## 9. ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì „ì²´ ìŠ¤íƒ í•„ìˆ˜ ì ìš©)

### ğŸ”’ 1. ë°°í‹€ í…ŒìŠ¤íŠ¸ëœ ì¸ì¦ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©

#### âœ… Clerk ì‚¬ìš©
```typescript
// app/layout.tsx
import { ClerkProvider } from '@clerk/nextjs';

export default function RootLayout({ children }) {
  return (
    <ClerkProvider>
      <html>
        <body>{children}</body>
      </html>
    </ClerkProvider>
  );
}
```

**ì™œ ì¤‘ìš”í•œê°€?**
- âŒ ì§ì ‘ êµ¬í˜„: ë¹„ë°€ë²ˆí˜¸ í•´ì‹±, ì„¸ì…˜ ê´€ë¦¬, í† í° ê°±ì‹  ë“± êµ¬í˜„ ë³µì¡
- âœ… Clerk ì‚¬ìš©: MFA, ì†Œì…œ ë¡œê·¸ì¸, ì„¸ì…˜ ê´€ë¦¬ ìë™ ì²˜ë¦¬
- âœ… ë³´ì•ˆ ì—…ë°ì´íŠ¸ ìë™ ì ìš©

---

### ğŸ”’ 2. ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ê¸ˆ

#### âœ… ëª¨ë“  APIì— ì¸ì¦ ì²´í¬
```typescript
// app/api/diagrams/route.ts
import { auth } from '@clerk/nextjs';

export async function GET(req: Request) {
  // ğŸ”’ ì²« ë²ˆì§¸ ì¤„: ì¸ì¦ ì²´í¬
  const { userId } = auth();
  
  if (!userId) {
    return Response.json(
      { error: 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.' },
      { status: 401 }
    );
  }
  
  // ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì—¬ê¸° ë„ë‹¬
  const diagrams = await db.query.diagrams.findMany({
    where: eq(diagrams.userId, userId),
  });
  
  return Response.json(diagrams);
}
```

**ì™œ ì¤‘ìš”í•œê°€?**
- âŒ ì¸ì¦ ì—†ìœ¼ë©´: ëˆ„êµ¬ë‚˜ API í˜¸ì¶œ â†’ DDoS ê³µê²©, ë°ì´í„° ìœ ì¶œ
- âœ… ì¸ì¦ ìˆìœ¼ë©´: ì‹ë³„ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼ â†’ ë‚¨ìš© ë°©ì§€

---

### ğŸ”’ 3. í”„ë¡ íŠ¸ì—”ë“œì— ì‹œí¬ë¦¿ ë…¸ì¶œ ê¸ˆì§€

#### âŒ ì ˆëŒ€ ì•ˆë¨
```typescript
// âŒ ìœ„í—˜: í´ë¼ì´ì–¸íŠ¸ì— ì‹œí¬ë¦¿ ë…¸ì¶œ
const API_KEY = 'sk_live_abc123...'; // ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìˆìŒ!

// âŒ í™˜ê²½ë³€ìˆ˜ë„ NEXT_PUBLIC_ ì ‘ë‘ì‚¬ ìˆìœ¼ë©´ ë…¸ì¶œë¨
const SECRET = process.env.NEXT_PUBLIC_SECRET_KEY; // ìœ„í—˜!
```

#### âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
```typescript
// âœ… ì„œë²„ ì»´í¬ë„ŒíŠ¸ë‚˜ API Routeì—ì„œë§Œ ì‚¬ìš©
// app/api/external/route.ts
const API_KEY = process.env.SECRET_API_KEY; // NEXT_PUBLIC_ ì—†ìŒ = ì•ˆì „

export async function GET() {
  const response = await fetch('https://api.example.com', {
    headers: {
      'Authorization': `Bearer ${API_KEY}`, // ì„œë²„ì—ì„œë§Œ ì‹¤í–‰
    },
  });
  
  return Response.json(await response.json());
}
```

**í™˜ê²½ë³€ìˆ˜ ê·œì¹™**
```bash
# .env.local

# âœ… ì„œë²„ ì „ìš© (ì•ˆì „)
DATABASE_URL=postgresql://...
CLERK_SECRET_KEY=sk_test_...

# âœ… í´ë¼ì´ì–¸íŠ¸ ë…¸ì¶œ í—ˆìš© (ê³µê°œ í‚¤ë§Œ)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
```

---

### ğŸ”’ 4. Gitì— ë¯¼ê°í•œ íŒŒì¼ ì ˆëŒ€ ì»¤ë°‹ ê¸ˆì§€

#### âœ… .gitignore í•„ìˆ˜ ì„¤ì •
```bash
# .gitignore
.env
.env.local
.env.*.local
.vercelignore
```

#### âœ… ì‹¤ìˆ˜ë¡œ ì»¤ë°‹í•œ ê²½ìš°
```bash
# íˆìŠ¤í† ë¦¬ì—ì„œ ì™„ì „íˆ ì œê±° (ì£¼ì˜!)
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch .env" \
  --prune-empty --tag-name-filter cat -- --all

# ëª¨ë“  ì‹œí¬ë¦¿ ì¦‰ì‹œ ë¡œí…Œì´ì…˜
# - Clerk í‚¤ ì¬ë°œê¸‰
# - DB ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
```

---

### ğŸ”’ 5. ì•ˆì „í•œ ì—ëŸ¬ ë©”ì‹œì§€

#### âŒ ìœ„í—˜í•œ ì—ëŸ¬ ë…¸ì¶œ
```typescript
// âŒ ë‚´ë¶€ êµ¬ì¡° ë…¸ì¶œ
catch (error) {
  return Response.json({
    error: error.message, // "Cannot connect to postgres at 10.0.0.5:5432"
    stack: error.stack,
  }, { status: 500 });
}
```

#### âœ… ì•ˆì „í•œ ì—ëŸ¬ ì²˜ë¦¬
```typescript
// âœ… ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€ë§Œ ë…¸ì¶œ
catch (error) {
  // ì„œë²„ ë¡œê·¸ì—ëŠ” ìì„¸íˆ (Sentry ë“±)
  console.error('DB Error:', error);
  Sentry.captureException(error);
  
  // í´ë¼ì´ì–¸íŠ¸ì—ëŠ” ì¼ë°˜ì  ë©”ì‹œì§€ë§Œ
  return Response.json({
    error: 'ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
  }, { status: 500 });
}
```

---

### ğŸ”’ 6. ë¯¸ë“¤ì›¨ì–´ë¡œ ì¸ì¦ ê²Œì´íŠ¸í‚¤í¼

#### âœ… Next.js ë¯¸ë“¤ì›¨ì–´
```typescript
// middleware.ts
import { authMiddleware } from '@clerk/nextjs';

export default authMiddleware({
  // ğŸ”’ ê³µê°œ ë¼ìš°íŠ¸ë§Œ ëª…ì‹œ
  publicRoutes: [
    '/',
    '/sign-in(.*)',
    '/sign-up(.*)',
  ],
  
  // ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ ì¸ì¦ í•„ìš”
});

export const config = {
  matcher: ['/((?!.+\\.[\\w]+$|_next).*)', '/', '/(api|trpc)(.*)'],
};
```

**íš¨ê³¼**
- ì¸ì¦ ì•ˆëœ ì‚¬ìš©ìëŠ” ìë™ìœ¼ë¡œ `/sign-in`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- API ë¼ìš°íŠ¸ë„ ìë™ ë³´í˜¸

---

### ğŸ”’ 7. ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC)

#### âœ… ì—­í•  ì •ì˜
```typescript
// lib/auth/roles.ts
export type Role = 'admin' | 'user' | 'guest';

export function hasPermission(userRole: Role, requiredRole: Role) {
  const hierarchy: Record<Role, number> = {
    admin: 3,
    user: 2,
    guest: 1,
  };
  
  return hierarchy[userRole] >= hierarchy[requiredRole];
}
```

#### âœ… APIì—ì„œ ì—­í•  ì²´í¬
```typescript
// app/api/admin/diagrams/route.ts
export async function DELETE(req: Request) {
  const { userId } = auth();
  if (!userId) return Response.json({ error: 'Unauthorized' }, { status: 401 });
  
  // ğŸ”’ ì—­í•  ì²´í¬
  const user = await db.query.users.findFirst({
    where: eq(users.id, userId),
  });
  
  if (user?.role !== 'admin') {
    return Response.json(
      { error: 'ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.' },
      { status: 403 }
    );
  }
  
  // ê´€ë¦¬ìë§Œ ì—¬ê¸° ë„ë‹¬
  await db.delete(diagrams).where(eq(diagrams.id, req.body.id));
  
  return Response.json({ success: true });
}
```

---

### ğŸ”’ 8. ë³´ì•ˆ DB ë¼ì´ë¸ŒëŸ¬ë¦¬/í”Œë«í¼ ì‚¬ìš©

#### âœ… Drizzle ORM + Vercel Postgres
```typescript
// âœ… ORMìœ¼ë¡œ SQL Injection ìë™ ë°©ì§€
const diagrams = await db.query.diagrams.findMany({
  where: eq(diagrams.userId, userId), // íŒŒë¼ë¯¸í„°í™”ëœ ì¿¼ë¦¬
});

// âŒ ì ˆëŒ€ ì•ˆë¨: Raw SQL ë¬¸ìì—´ ì¡°í•©
// const query = `SELECT * FROM diagrams WHERE user_id = '${userId}'`; // SQL Injection ìœ„í—˜!
```

**Vercel Postgres ì¥ì **
- Row-Level Security (RLS) ì§€ì›
- ìë™ ë°±ì—…
- Connection pooling
- SSL ê°•ì œ

---

### ğŸ”’ 9. ë³´ì•ˆ í˜¸ìŠ¤íŒ… í”Œë«í¼ (Vercel)

#### âœ… Vercel ë³´ì•ˆ ê¸°ëŠ¥
- **ìë™ HTTPS**: SSL ì¸ì¦ì„œ ìë™ ê°±ì‹ 
- **DDoS ë³´í˜¸**: Edge Networkì—ì„œ ì°¨ë‹¨
- **WAF**: ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°©í™”ë²½
- **í™˜ê²½ë³€ìˆ˜ ì•”í˜¸í™”**: ë¹Œë“œ ì‹œì—ë§Œ ë³µí˜¸í™”

```bash
# Vercel ë°°í¬
vercel --prod

# í™˜ê²½ë³€ìˆ˜ëŠ” Vercel Dashboardì—ì„œ ê´€ë¦¬
# Settings â†’ Environment Variables
```

---

### ğŸ”’ 10. HTTPS ê°•ì œ

#### âœ… Vercelì€ ìë™ìœ¼ë¡œ HTTPS ê°•ì œ
```typescript
// next.config.js (ì¶”ê°€ ë³´ì•ˆ í—¤ë”)
module.exports = {
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'Strict-Transport-Security',
            value: 'max-age=31536000; includeSubDomains',
          },
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
          {
            key: 'Referrer-Policy',
            value: 'strict-origin-when-cross-origin',
          },
        ],
      },
    ];
  },
};
```

---

### ğŸ”’ 11. íŒŒì¼ ì—…ë¡œë“œ ë³´ì•ˆ

#### âœ… ì•ˆì „í•œ íŒŒì¼ ì—…ë¡œë“œ
```typescript
// app/api/upload/route.ts
import { put } from '@vercel/blob';

const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB
const ALLOWED_TYPES = ['image/png', 'image/jpeg', 'application/xml'];

export async function POST(req: Request) {
  const { userId } = auth();
  if (!userId) return Response.json({ error: 'Unauthorized' }, { status: 401 });
  
  const formData = await req.formData();
  const file = formData.get('file') as File;
  
  // ğŸ”’ íŒŒì¼ í¬ê¸° ì²´í¬
  if (file.size > MAX_FILE_SIZE) {
    return Response.json(
      { error: 'íŒŒì¼ í¬ê¸°ëŠ” 5MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },
      { status: 400 }
    );
  }
  
  // ğŸ”’ íŒŒì¼ íƒ€ì… ì²´í¬
  if (!ALLOWED_TYPES.includes(file.type)) {
    return Response.json(
      { error: 'í—ˆìš©ë˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.' },
      { status: 400 }
    );
  }
  
  // ğŸ”’ íŒŒì¼ëª… ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
  const safeFileName = `${userId}/${Date.now()}-${file.name.replace(/[^a-zA-Z0-9.-]/g, '')}`;
  
  // Vercel Blobì— ì—…ë¡œë“œ
  const blob = await put(safeFileName, file, {
    access: 'public',
    addRandomSuffix: true,
  });
  
  return Response.json({ url: blob.url });
}
```

---

### ğŸ”’ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½

í”„ë¡œë•ì…˜ ë°°í¬ ì „ í•„ìˆ˜ í™•ì¸:

- [ ] âœ… Clerk ì¸ì¦ ì„¤ì • ì™„ë£Œ
- [ ] âœ… ëª¨ë“  API ë¼ìš°íŠ¸ì— `auth()` ì²´í¬ ì¶”ê°€
- [ ] âœ… í™˜ê²½ë³€ìˆ˜ì— `NEXT_PUBLIC_` ì ‘ë‘ì‚¬ ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©
- [ ] âœ… `.env.local`ì´ `.gitignore`ì— í¬í•¨ë¨
- [ ] âœ… ì—ëŸ¬ ë©”ì‹œì§€ì— ë‚´ë¶€ ì •ë³´ ë…¸ì¶œ ì•ˆë¨
- [ ] âœ… ë¯¸ë“¤ì›¨ì–´ë¡œ ë³´í˜¸ëœ ë¼ìš°íŠ¸ ì„¤ì •
- [ ] âœ… ì—­í•  ê¸°ë°˜ ê¶Œí•œ ì²´í¬ êµ¬í˜„ (í•„ìš” ì‹œ)
- [ ] âœ… Drizzle ORM ì‚¬ìš© (Raw SQL ê¸ˆì§€)
- [ ] âœ… Vercel HTTPS ìë™ ì ìš© í™•ì¸
- [ ] âœ… ë³´ì•ˆ í—¤ë” ì„¤ì • (`next.config.js`)
- [ ] âœ… íŒŒì¼ ì—…ë¡œë“œ ê²€ì¦ (í¬ê¸°, íƒ€ì…, ìŠ¤ìº”)

---

## 10. ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ ì „ í™•ì¸ì‚¬í•­

```bash
# 1. í™˜ê²½ë³€ìˆ˜ í™•ì¸
vercel env pull .env.local

# 2. íƒ€ì… ì²´í¬
npm run type-check

# 3. ë¦°íŠ¸
npm run lint

# 4. ë¹Œë“œ í…ŒìŠ¤íŠ¸
npm run build

# 5. í”„ë¡œë•ì…˜ ëª¨ë“œ ë¡œì»¬ í…ŒìŠ¤íŠ¸
npm run start

# 6. E2E í…ŒìŠ¤íŠ¸
npm run test:e2e

# 7. Lighthouse ì ìˆ˜ í™•ì¸
```

### ë°°í¬ ëª…ë ¹
```bash
# í”„ë¡œë•ì…˜ ë°°í¬
vercel --prod

# íŠ¹ì • ë¸Œëœì¹˜ í”„ë¦¬ë·°
git push origin feature/new-feature
# Vercelì´ ìë™ìœ¼ë¡œ í”„ë¦¬ë·° URL ìƒì„±
```

---

## ê²°ë¡ 

ì´ ì²­ì‚¬ì§„ì„ ë”°ë¼ êµ¬í˜„í•˜ë©´:

âœ… **ë³´ì•ˆ**: Clerk + ë¯¸ë“¤ì›¨ì–´ + í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬ë¡œ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë³´ì•ˆ  
âœ… **ì„±ëŠ¥**: React ìµœì í™” + Next.js SSR + Vercel CDNìœ¼ë¡œ ë¹ ë¥¸ ë¡œë”©  
âœ… **í™•ì¥ì„±**: Drizzle ORM + Vercel Postgresë¡œ ì†ì‰¬ìš´ í™•ì¥  
âœ… **ìœ ì§€ë³´ìˆ˜ì„±**: TypeScript + ëª…í™•í•œ í´ë” êµ¬ì¡° + í…ŒìŠ¤íŠ¸ë¡œ ì¥ê¸° ê´€ë¦¬ ìš©ì´  
âœ… **ì‚¬ìš©ì ê²½í—˜**: shadcn/ui + ë°˜ì‘í˜• ë””ìì¸ + ì ‘ê·¼ì„±ìœ¼ë¡œ ëª¨ë“  ì‚¬ìš©ì ë§Œì¡±  

**ë‹¤ìŒ ë‹¨ê³„**: Phase 1ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ êµ¬í˜„ì„ ì‹œì‘í•˜ì„¸ìš”! ğŸš€

